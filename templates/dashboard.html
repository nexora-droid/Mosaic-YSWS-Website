<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mosaic Dashboard {% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav id="navbar">
        <div class="nav-tab active">
            The Studio
        </div>
        <div class="nav-tab" onclick="window.location.href='/leaderboard'">
            Leaderboard
        </div>
        <div class="nav-tab" onclick="window.location.href='/market'">
            <i class="fas fa-lock"></i> Market
        </div>
        {% if user and is_admin(user) %}
        <div class="nav-tab" onclick="window.location.href='/admin/dashboard'">
            Admin Dashboard
        </div>
        {% endif %}
        <div class="nav-tab wip">
            Orpheus
        </div>
    </nav>

    <div id="dashboard-container">
        <div id="left-side">
            <div class="section-header">
                <h2>Your Projects</h2>
                <button id="add-project-btn" class="add-btn">
                    +
                </button>
            </div>
            
            <div id="projects-list">
                {% for sp in saved_projects %}
                <div class="project-card" 
                     data-project-id="{{sp.id}}" 
                     data-hackatime-project="{{sp.hackatime_project}}"
                     onclick="selectProject('{{sp.id}}')">
                    <div class="project-name">
                        {{sp.name}}
                    </div>
                    <div class="project-status status-{{ sp.status }}">
                        {% if sp.status == 'approved' %}Sold
                        {% elif sp.status == 'rejected' %}Refunded
                        {% elif sp.status == 'draft' %}Building
                        {% else %}{{ sp.status }}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div id="right-side">
            <div id="empty-state" {% if saved_projects %}style="display: none;"{% endif %}>
                <p class="empty-message">No Tile-work selected...</p>
            </div>
            
            <div id="project-info" {% if not saved_projects %}style="display: none;"{% endif %}>
            </div>
            
            <div id="bottom-info">
                <div class="info-card tiles-balance">
                    Current Balance: {{ user.tiles_balance if user.tiles_balance else 0 }} Tiles
                </div>
                <div class="info-card current-theme">
                    Current Theme: <span id="theme-name">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    {% if not auto_connected %}
    <div id="hackatime-warning" onclick="showHackatimePopup()">
        âš 
    </div>
    {% endif %}

    <div id="hackatime-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeHackatimePopup()">&times;</span>
            <h3>Hackatime Not Connected</h3>
            <p>Your Hackatime is not tracking properly. Please message <strong>@the space man</strong> on Slack for help.</p>
            <button onclick="closeHackatimePopup()" class="btn-primary">Got it</button>
        </div>
    </div>

    <div id="overlay" class="overlay hidden">
        <div class="overlay-content">
            <h2>Add Project</h2>
            <form id="add-project-form">
                <div class="form-group">
                    <label for="project-name">Project Name *</label>
                    <input type="text" id="project-name" name="project-name" required>
                </div>
                <div class="form-group">
                    <label for="hack-project">Hackatime Project:</label>
                    <select id="hack-project" name="hack-project" class="custom-select">
                        <option value="">None / Choose a Hackatime Project</option>
                        {% if auto_connected and projects %}
                            {% for project in projects %}
                                <option value="{{ project['name']}}">{{ project['name']}}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>
                <p id="project-hours" class="hours-preview"></p>

                <div class="form-group">
                    <label for="project-detail">One Liner Description *</label>
                    <input type="text" id="project-detail" name="project-detail" placeholder="Brief one-line detail!" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Add Project</button>
                    <button type="button" id="close-overlay" class="btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="submit-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h2>Submit Project for Review</h2>
            <form id="submit-project-form">
                <input type="hidden" id="submit-project-id">
                <div class="form-group">
                    <label for="screenshot-url">Image Link (via #cdn on Slack!) *</label>
                    <input type="url" id="screenshot-url" name="screenshot-url" required>
                    <div id="screenshot-preview" class="image-preview"></div>
                </div>
                <div class="form-group">
                    <label for="github-url">Github Link (please set to Public) *</label>
                    <input type="url" id="github-url" name="github-url" required>
                </div>
                <div class="form-group">
                    <label for="demo-url">Demo Link (please ensure it works!) *</label>
                    <input type="url" id="demo-url" name="demo-url" required>
                </div>
                <div class="form-group">
                    <label for="languages">Languages Used *</label>
                    <input type="text" id="languages" name="languages" required placeholder="e.g. Python, Javascript, HTML, CSS">
                </div>
                <div class="form-group">
                    <label for="summary">Project Summary *</label>
                    <textarea id="summary" name="summary" required placeholder="Explain what your project does and what you learnt..." rows="4"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Submit for Review</button>
                    <button type="button" id="close-submit" class="btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/alert_modal.js')}}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js')}}"></script>
</body>
</html>